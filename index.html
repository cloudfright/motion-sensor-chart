<!DOCTYPE html>
<html>

<head>
  <script type="text/javascript" src="scripts/smoothie.js"></script>
  <script type="text/javascript">

    var series1 = new TimeSeries();
    var series2 = new TimeSeries();
    var series3 = new TimeSeries();

    /*
    // Randomly add a data point every 500ms
    setInterval(function () {
      var now = Date.now();
      var val = Math.random() * 100;
      series1.append(now, val);
    }, 500);
*/
    function createTimeline() {

      var chart = new SmoothieChart({ responsive: true });
      chart.addTimeSeries(series1, { strokeStyle: 'rgba(255, 0, 0, 1)', fillStyle: 'rgba(255, 0, 0, 0.2)', lineWidth: 4 });
      chart.addTimeSeries(series2, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 4 });
      chart.addTimeSeries(series3, { strokeStyle: 'rgba(0, 0, 255, 1)', fillStyle: 'rgba(0, 0, 255, 0.2)', lineWidth: 4 });
      chart.streamTo(document.getElementById("chart-responsive"), 500);
    }
  </script>
</head>

<body onload="createTimeline()" style="background-color:#333333">
  <button onclick="requestPermission()">Request Permission</button>
  <canvas id="chart-responsive" style="width:100%;height:100px"></canvas>

  <script>

    function requestPermission() {
      console.log('clicked');
      if (typeof DeviceMotionEvent.requestPermission === 'function') {
        // Handle iOS 13+ devices.
        DeviceMotionEvent.requestPermission()
          .then((state) => {
            if (state === 'granted') {
              window.addEventListener('devicemotion', handleOrientation);
            } else {
              console.error('Request to access the orientation was rejected');
            }
          })
          .catch(console.error);
      } else {
        // Handle regular non iOS 13+ devices.
        window.addEventListener('devicemotion', handleOrientation);
      }
    }

    function handleOrientation(event) {

      var now = Date.now();
      var val = Math.random() * 100;
      series1.append(now, event.rotationRate.alpha);            
      series2.append(now, event.rotationRate.beta);            
      series3.append(now, event.rotationRate.gamma);            
    }

  </script>
</body>

</html>