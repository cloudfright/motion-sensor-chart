<!DOCTYPE html>
<html>

<head>
  <script type="text/javascript" src="scripts/smoothie.js"></script>
  <script type="text/javascript">

    var gyroSeries1 = new TimeSeries();
    var gyroSeries2 = new TimeSeries();
    var gyroSeries3 = new TimeSeries();

    var accellSeries1 = new TimeSeries();
    var accellSeries2 = new TimeSeries();
    var accellSeries3 = new TimeSeries();

    var accellGravitySeries1 = new TimeSeries();
    var accellGravitySeries2  = new TimeSeries();
    var accellGravitySeries3  = new TimeSeries();


    function createTimeline() {

      var gyroChart = new SmoothieChart({ responsive: true });
      gyroChart.addTimeSeries(gyroSeries1, { strokeStyle: 'rgba(255, 0, 0, 1)', fillStyle: 'rgba(255, 0, 0, 0.2)', lineWidth: 3 });
      gyroChart.addTimeSeries(gyroSeries2, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 3 });
      gyroChart.addTimeSeries(gyroSeries3, { strokeStyle: 'rgba(0, 0, 255, 1)', fillStyle: 'rgba(0, 0, 255, 0.2)', lineWidth: 3 });
      gyroChart.streamTo(document.getElementById("gryo-chart"), 500);

      var accellChart = new SmoothieChart({ responsive: true });
      accellChart.addTimeSeries(accellSeries1, { strokeStyle: 'rgba(255, 0, 0, 1)', fillStyle: 'rgba(255, 0, 0, 0.2)', lineWidth: 3 });
      accellChart.addTimeSeries(accellSeries2, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 3 });
      accellChart.addTimeSeries(accellSeries3, { strokeStyle: 'rgba(0, 0, 255, 1)', fillStyle: 'rgba(0, 0, 255, 0.2)', lineWidth: 3 });
      accellChart.streamTo(document.getElementById("accel-ng-chart"), 500);

      var accellGravityChart = new SmoothieChart({ responsive: true });
      accellGravityChart.addTimeSeries(accellGravitySeries1, { strokeStyle: 'rgba(255, 0, 0, 1)', fillStyle: 'rgba(255, 0, 0, 0.2)', lineWidth: 3 });
      accellGravityChart.addTimeSeries(accellGravitySeries2, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 3 });
      accellGravityChart.addTimeSeries(accellGravitySeries3, { strokeStyle: 'rgba(0, 0, 255, 1)', fillStyle: 'rgba(0, 0, 255, 0.2)', lineWidth: 3 });
      accellGravityChart.streamTo(document.getElementById("accel-wg-chart"), 500);

    }
  </script>
</head>

<body onload="createTimeline()" style="background-color:#333333">
  <button onclick="requestPermission()">Request Permission</button>

  <h5 style="color:white">Gyroscope</h5>
  <canvas id="gryo-chart" style="width:100%;height:100px"></canvas>

  <h5  style="color:white">Accelerometer</h5>
  <canvas id="accel-ng-chart" style="width:100%;height:100px"></canvas>

  <h5 style="color:white">Accelerometer with gravity</h5>
  <canvas id="accel-wg-chart" style="width:100%;height:100px"></canvas>


  <script>

    function requestPermission() {
      console.log('clicked');
      if (typeof DeviceMotionEvent.requestPermission === 'function') {
        // Handle iOS 13+ devices.
        DeviceMotionEvent.requestPermission()
          .then((state) => {
            if (state === 'granted') {
              window.addEventListener('devicemotion', handleOrientation);
            } else {
              console.error('Request to access the orientation was rejected');
            }
          })
          .catch(console.error);
      } else {
        // Handle regular non iOS 13+ devices.
        window.addEventListener('devicemotion', handleOrientation);
      }
    }

    function handleOrientation(event) {

      var now = Date.now();
      gyroSeries1.append(now, event.rotationRate.alpha);            
      gyroSeries2.append(now, event.rotationRate.beta);            
      gyroSeries3.append(now, event.rotationRate.gamma);   

      accellSeries1.append(now, event.acceleration.x);            
      accellSeries2.append(now, event.acceleration.y);            
      accellSeries3.append(now, event.acceleration.z);            

      accellGravitySeries1.append(now, event.accelerationIncludingGravity.x);            
      accellGravitySeries2.append(now, event.accelerationIncludingGravity.y);            
      accellGravitySeries3.append(now, event.accelerationIncludingGravity.z);   
    }

  </script>
</body>

</html>