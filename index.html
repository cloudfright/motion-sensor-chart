<!DOCTYPE html>
<html>

<head>
  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script type="text/javascript" src="scripts/smoothie.js"></script>
  <script type="text/javascript">

    var gyroSeries1 = new TimeSeries();
    var gyroSeries2 = new TimeSeries();
    var gyroSeries3 = new TimeSeries();

    var accellSeries1 = new TimeSeries();
    var accellSeries2 = new TimeSeries();
    var accellSeries3 = new TimeSeries();

    var accellGravitySeries1 = new TimeSeries();
    var accellGravitySeries2 = new TimeSeries();
    var accellGravitySeries3 = new TimeSeries();

    function createTimeline() {

      var gyroChart = new SmoothieChart({ responsive: true, scrollBackwards:true });
      gyroChart.addTimeSeries(gyroSeries1, { strokeStyle: 'rgba(255, 0, 0, 1)', fillStyle: 'rgba(255, 0, 0, 0.2)', lineWidth: 3 });
      gyroChart.addTimeSeries(gyroSeries2, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 3 });
      gyroChart.addTimeSeries(gyroSeries3, { strokeStyle: 'rgba(0, 0, 255, 1)', fillStyle: 'rgba(0, 0, 255, 0.2)', lineWidth: 3 });
      gyroChart.streamTo(document.getElementById("gryo-chart"), 500);

      var accellChart = new SmoothieChart({ responsive: true, scrollBackwards:true  });
      accellChart.addTimeSeries(accellSeries1, { strokeStyle: 'rgba(255, 0, 0, 1)', fillStyle: 'rgba(255, 0, 0, 0.2)', lineWidth: 3 });
      accellChart.addTimeSeries(accellSeries2, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 3 });
      accellChart.addTimeSeries(accellSeries3, { strokeStyle: 'rgba(0, 0, 255, 1)', fillStyle: 'rgba(0, 0, 255, 0.2)', lineWidth: 3 });
      accellChart.streamTo(document.getElementById("accel-ng-chart"), 500);

      var accellGravityChart = new SmoothieChart({ responsive: true, scrollBackwards:true  });
      accellGravityChart.addTimeSeries(accellGravitySeries1, { strokeStyle: 'rgba(255, 0, 0, 1)', fillStyle: 'rgba(255, 0, 0, 0.2)', lineWidth: 3 });
      accellGravityChart.addTimeSeries(accellGravitySeries2, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 3 });
      accellGravityChart.addTimeSeries(accellGravitySeries3, { strokeStyle: 'rgba(0, 0, 255, 1)', fillStyle: 'rgba(0, 0, 255, 0.2)', lineWidth: 3 });
      accellGravityChart.streamTo(document.getElementById("accel-wg-chart"), 500);

    }
  </script>
</head>

<body onload="createTimeline()" style="background-color:#fefefc">
  <button type="button" class="btn btn-outline-primary btn-sm " onclick="requestPermission()">Request Permission</button>

  <h6>Rotation rate
    <small style="color:red">Alpha</small>
    <small style="color:green">Beta</small>
    <small  style="color:blue">Gamma</small>
  </h6>

  <canvas id="gryo-chart" style="width:100%;height:100px"></canvas>

  <h6>Accelerometer
    <small style="color:red">x</small>
    <small style="color:green">y</small>
    <small  style="color:blue">z</small>
  </h6>
  <canvas id="accel-ng-chart" style="width:100%;height:100px"></canvas>

  <h6>Accelerometer incl. gravity
    <small style="color:red">x</small>
    <small style="color:green">y</small>
    <small  style="color:blue">z</small>
  </h6>
  <canvas id="accel-wg-chart" style="width:100%;height:100px"></canvas>


  <script>

    function requestPermission() {
      console.log('clicked');
      if (typeof DeviceMotionEvent.requestPermission === 'function') {
        // Handle iOS 13+ devices.
        DeviceMotionEvent.requestPermission()
          .then((state) => {
            if (state === 'granted') {
              window.addEventListener('devicemotion', handleOrientation);
            } else {
              console.error('Request to access the orientation was rejected');
            }
          })
          .catch(console.error);
      } else {
        // Handle regular non iOS 13+ devices.
        window.addEventListener('devicemotion', handleOrientation);
      }
    }

    function handleOrientation(event) {

      var now = Date.now();
      gyroSeries1.append(now, event.rotationRate.alpha);
      gyroSeries2.append(now, event.rotationRate.beta);
      gyroSeries3.append(now, event.rotationRate.gamma);

      accellSeries1.append(now, event.acceleration.x);
      accellSeries2.append(now, event.acceleration.y);
      accellSeries3.append(now, event.acceleration.z);

      accellGravitySeries1.append(now, event.accelerationIncludingGravity.x);
      accellGravitySeries2.append(now, event.accelerationIncludingGravity.y);
      accellGravitySeries3.append(now, event.accelerationIncludingGravity.z);
    }

  </script>
</body>

</html>